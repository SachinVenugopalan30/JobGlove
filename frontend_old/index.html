<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JobGlove - AI-Powered Resume Tailoring</title>
    <link rel="stylesheet" href="css/styles.css">
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
</head>
<body>
    <div class="container" x-data="resumeApp()">
        <header class="header">
            <h1>JobGlove</h1>
            <p>Tailor your resume to any job description using AI</p>
        </header>

        <main class="main-content">
            <!-- User Information -->
            <section class="section">
                <h2>Your Information</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="user-name" class="form-label">Your Name</label>
                        <input
                            type="text"
                            id="user-name"
                            class="form-input"
                            placeholder="John Doe"
                            x-model="userName"
                            :disabled="isProcessing"
                        >
                    </div>
                    <div class="form-group">
                        <label for="company" class="form-label">Company Name</label>
                        <input
                            type="text"
                            id="company"
                            class="form-input"
                            placeholder="Tech Corp"
                            x-model="company"
                            :disabled="isProcessing"
                        >
                    </div>
                    <div class="form-group">
                        <label for="job-title" class="form-label">Job Title</label>
                        <input
                            type="text"
                            id="job-title"
                            class="form-input"
                            placeholder="Software Engineer"
                            x-model="jobTitle"
                            :disabled="isProcessing"
                        >
                    </div>
                </div>
            </section>

            <!-- API Selection -->
            <section class="section">
                <h2>Select AI Provider</h2>
                <div class="api-selector">
                    <template x-for="(available, api) in availableApis" :key="api">
                        <label class="radio-label" :class="{ 'disabled': !available }">
                            <input
                                type="radio"
                                name="api"
                                :value="api"
                                x-model="selectedApi"
                                :disabled="!available"
                            >
                            <span x-text="api.charAt(0).toUpperCase() + api.slice(1)"></span>
                            <span x-show="!available" class="unavailable">(Unavailable)</span>
                        </label>
                    </template>
                </div>
            </section>

            <!-- File Upload -->
            <section class="section">
                <h2>Upload Resume</h2>
                <div class="file-upload">
                    <input
                        type="file"
                        id="resume-file"
                        accept=".doc,.docx"
                        @change="handleFileChange($event)"
                        :disabled="isProcessing"
                    >
                    <label for="resume-file" class="file-label">
                        <span x-text="resumeFileName || 'Choose DOCX or DOC file'"></span>
                    </label>
                </div>
            </section>

            <!-- Job Description -->
            <section class="section">
                <h2>Job Description</h2>
                <textarea
                    class="job-description"
                    placeholder="Paste the job description here..."
                    x-model="jobDescription"
                    :disabled="isProcessing"
                    rows="10"
                ></textarea>
                <div class="char-count" x-show="jobDescription.length > 0">
                    <span x-text="jobDescription.length"></span> characters
                </div>
            </section>

            <!-- Custom Prompt (Optional) -->
            <section class="section">
                <div class="collapsible-header" @click="showCustomPrompt = !showCustomPrompt">
                    <h2>Custom Instructions (Optional)</h2>
                    <svg
                        class="chevron-icon"
                        :class="{ 'rotated': showCustomPrompt }"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                </div>
                <div x-show="showCustomPrompt" x-collapse>
                    <textarea
                        class="custom-prompt"
                        placeholder="Add any specific instructions for the AI (e.g., 'Emphasize leadership experience', 'Focus on technical skills', etc.)"
                        x-model="customPrompt"
                        :disabled="isProcessing"
                        rows="4"
                    ></textarea>
                </div>
            </section>

            <!-- Submit Button -->
            <section class="section">
                <button
                    class="btn-primary"
                    @click="tailorResume()"
                    :disabled="!canSubmit()"
                    :class="{ 'loading': isProcessing }"
                >
                    <span x-show="!isProcessing">
                        <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                        </svg>
                        Tailor Resume
                    </span>
                    <span x-show="isProcessing">Processing...</span>
                </button>

                <!-- Processing Status -->
                <div x-show="isProcessing" class="processing-status">
                    <div class="status-spinner"></div>
                    <p x-text="processingStatus"></p>
                </div>
            </section>

            <!-- Error Message -->
            <div x-show="errorMessage" class="error-message">
                <p x-text="errorMessage"></p>
                <button @click="errorMessage = null" class="close-btn">Ã—</button>
            </div>

            <!-- Success Message with Download -->
            <div x-show="downloadUrl" class="success-message">
                <svg class="success-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <h3>Resume Tailored Successfully!</h3>
                <p>Your customized resume is ready for download</p>
                <div class="download-buttons">
                    <a
                        :href="downloadUrl"
                        class="btn-download btn-download-primary"
                        download="tailored_resume.pdf"
                    >
                        <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        Download PDF
                    </a>
                    <a
                        :href="texDownloadUrl"
                        class="btn-download btn-download-secondary"
                        download="tailored_resume.tex"
                    >
                        <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
                        </svg>
                        Download LaTeX Source
                    </a>
                </div>
                <button
                    @click="scoreResumes()"
                    class="btn-score"
                    :disabled="isScoring"
                    x-show="!scoresLoaded"
                >
                    <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                    </svg>
                    <span x-show="!isScoring">Compare Resume Scores</span>
                    <span x-show="isScoring">Scoring...</span>
                </button>
            </div>

            <!-- Scoring Comparison -->
            <div x-show="scoresLoaded" class="scoring-section">
                <h2>Resume Score Comparison</h2>
                <p class="scoring-subtitle">See how your tailored resume compares to the original</p>

                <div class="scores-container">
                    <!-- Original Resume Score -->
                    <div class="score-card">
                        <div class="score-card-header">
                            <h3>Original Resume</h3>
                            <div class="total-score" :class="getScoreClass(originalScores.total_score)">
                                <span class="score-number" x-text="originalScores.total_score"></span>
                                <span class="score-label">/100</span>
                            </div>
                        </div>
                        <div class="score-categories">
                            <div class="score-category">
                                <div class="score-category-header">
                                    <span class="category-name">ATS Compatibility</span>
                                    <span class="category-value" x-text="originalScores.ats_score"></span>
                                </div>
                                <div class="score-bar">
                                    <div class="score-bar-fill" :style="`width: ${originalScores.ats_score}%`"></div>
                                </div>
                            </div>
                            <div class="score-category">
                                <div class="score-category-header">
                                    <span class="category-name">Content Quality</span>
                                    <span class="category-value" x-text="originalScores.content_score"></span>
                                </div>
                                <div class="score-bar">
                                    <div class="score-bar-fill" :style="`width: ${originalScores.content_score}%`"></div>
                                </div>
                            </div>
                            <div class="score-category">
                                <div class="score-category-header">
                                    <span class="category-name">Writing Style</span>
                                    <span class="category-value" x-text="originalScores.style_score"></span>
                                </div>
                                <div class="score-bar">
                                    <div class="score-bar-fill" :style="`width: ${originalScores.style_score}%`"></div>
                                </div>
                            </div>
                            <div class="score-category">
                                <div class="score-category-header">
                                    <span class="category-name">Job Match</span>
                                    <span class="category-value" x-text="originalScores.match_score"></span>
                                </div>
                                <div class="score-bar">
                                    <div class="score-bar-fill" :style="`width: ${originalScores.match_score}%`"></div>
                                </div>
                            </div>
                            <div class="score-category">
                                <div class="score-category-header">
                                    <span class="category-name">Overall Readiness</span>
                                    <span class="category-value" x-text="originalScores.readiness_score"></span>
                                </div>
                                <div class="score-bar">
                                    <div class="score-bar-fill" :style="`width: ${originalScores.readiness_score}%`"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tailored Resume Score -->
                    <div class="score-card">
                        <div class="score-card-header">
                            <h3>Tailored Resume</h3>
                            <div class="total-score" :class="getScoreClass(tailoredScores.total_score)">
                                <span class="score-number" x-text="tailoredScores.total_score"></span>
                                <span class="score-label">/100</span>
                            </div>
                            <div class="score-improvement" x-show="tailoredScores.total_score > originalScores.total_score">
                                <svg class="improvement-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                                </svg>
                                <span x-text="`+${tailoredScores.total_score - originalScores.total_score} points`"></span>
                            </div>
                        </div>
                        <div class="score-categories">
                            <div class="score-category">
                                <div class="score-category-header">
                                    <span class="category-name">ATS Compatibility</span>
                                    <span class="category-value" x-text="tailoredScores.ats_score"></span>
                                    <span class="category-diff" x-show="tailoredScores.ats_score !== originalScores.ats_score"
                                          :class="tailoredScores.ats_score > originalScores.ats_score ? 'positive' : 'negative'"
                                          x-text="(tailoredScores.ats_score > originalScores.ats_score ? '+' : '') + (tailoredScores.ats_score - originalScores.ats_score)">
                                    </span>
                                </div>
                                <div class="score-bar">
                                    <div class="score-bar-fill improved" :style="`width: ${tailoredScores.ats_score}%`"></div>
                                </div>
                            </div>
                            <div class="score-category">
                                <div class="score-category-header">
                                    <span class="category-name">Content Quality</span>
                                    <span class="category-value" x-text="tailoredScores.content_score"></span>
                                    <span class="category-diff" x-show="tailoredScores.content_score !== originalScores.content_score"
                                          :class="tailoredScores.content_score > originalScores.content_score ? 'positive' : 'negative'"
                                          x-text="(tailoredScores.content_score > originalScores.content_score ? '+' : '') + (tailoredScores.content_score - originalScores.content_score)">
                                    </span>
                                </div>
                                <div class="score-bar">
                                    <div class="score-bar-fill improved" :style="`width: ${tailoredScores.content_score}%`"></div>
                                </div>
                            </div>
                            <div class="score-category">
                                <div class="score-category-header">
                                    <span class="category-name">Writing Style</span>
                                    <span class="category-value" x-text="tailoredScores.style_score"></span>
                                    <span class="category-diff" x-show="tailoredScores.style_score !== originalScores.style_score"
                                          :class="tailoredScores.style_score > originalScores.style_score ? 'positive' : 'negative'"
                                          x-text="(tailoredScores.style_score > originalScores.style_score ? '+' : '') + (tailoredScores.style_score - originalScores.style_score)">
                                    </span>
                                </div>
                                <div class="score-bar">
                                    <div class="score-bar-fill improved" :style="`width: ${tailoredScores.style_score}%`"></div>
                                </div>
                            </div>
                            <div class="score-category">
                                <div class="score-category-header">
                                    <span class="category-name">Job Match</span>
                                    <span class="category-value" x-text="tailoredScores.match_score"></span>
                                    <span class="category-diff" x-show="tailoredScores.match_score !== originalScores.match_score"
                                          :class="tailoredScores.match_score > originalScores.match_score ? 'positive' : 'negative'"
                                          x-text="(tailoredScores.match_score > originalScores.match_score ? '+' : '') + (tailoredScores.match_score - originalScores.match_score)">
                                    </span>
                                </div>
                                <div class="score-bar">
                                    <div class="score-bar-fill improved" :style="`width: ${tailoredScores.match_score}%`"></div>
                                </div>
                            </div>
                            <div class="score-category">
                                <div class="score-category-header">
                                    <span class="category-name">Overall Readiness</span>
                                    <span class="category-value" x-text="tailoredScores.readiness_score"></span>
                                    <span class="category-diff" x-show="tailoredScores.readiness_score !== originalScores.readiness_score"
                                          :class="tailoredScores.readiness_score > originalScores.readiness_score ? 'positive' : 'negative'"
                                          x-text="(tailoredScores.readiness_score > originalScores.readiness_score ? '+' : '') + (tailoredScores.readiness_score - originalScores.readiness_score)">
                                    </span>
                                </div>
                                <div class="score-bar">
                                    <div class="score-bar-fill improved" :style="`width: ${tailoredScores.readiness_score}%`"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Review Button -->
                <button
                    @click="reviewResume()"
                    class="btn-review"
                    :disabled="isReviewing"
                    x-show="scoresLoaded && !reviewLoaded"
                >
                    <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
                    </svg>
                    <span x-show="!isReviewing">Get Detailed Review</span>
                    <span x-show="isReviewing">Analyzing...</span>
                </button>
            </div>

            <!-- Bullet-by-Bullet Review -->
            <div x-show="reviewLoaded" class="review-section">
                <h2>Detailed Resume Review</h2>
                <p class="review-subtitle">Bullet-by-bullet analysis of your tailored resume</p>

                <div class="review-container">
                    <template x-for="(bullets, section) in groupedBullets" :key="section">
                        <div class="review-section-group">
                            <h3 class="section-title" x-text="section"></h3>
                            <div class="bullets-list">
                                <template x-for="(bullet, index) in bullets" :key="index">
                                    <div class="bullet-card">
                                        <div class="bullet-header">
                                            <span class="bullet-number" x-text="`#${index + 1}`"></span>
                                            <div class="relevance-badge" :class="getRelevanceClass(bullet.relevance_score)">
                                                <svg class="badge-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
                                                </svg>
                                                <span x-text="bullet.relevance_score + '/5'"></span>
                                            </div>
                                        </div>

                                        <div class="bullet-content">
                                            <div class="bullet-original">
                                                <label class="content-label">Original Text</label>
                                                <p class="bullet-text" x-text="bullet.original_text"></p>
                                            </div>

                                            <div class="bullet-strengths" x-show="bullet.strengths && bullet.strengths.length > 0">
                                                <label class="content-label strengths-label">
                                                    <svg class="label-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                    </svg>
                                                    Strengths
                                                </label>
                                                <ul class="strengths-list">
                                                    <template x-for="strength in bullet.strengths" :key="strength">
                                                        <li x-text="strength"></li>
                                                    </template>
                                                </ul>
                                            </div>

                                            <div class="bullet-suggestions" x-show="bullet.refinement_suggestions && bullet.refinement_suggestions.length > 0">
                                                <label class="content-label suggestions-label">
                                                    <svg class="label-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                    </svg>
                                                    Refinement Suggestions
                                                </label>
                                                <ul class="suggestions-list">
                                                    <template x-for="suggestion in bullet.refinement_suggestions" :key="suggestion">
                                                        <li x-text="suggestion"></li>
                                                    </template>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </main>

        <footer class="footer">
            <p>Open source resume tailoring tool powered by AI</p>
        </footer>
    </div>

    <script src="js/app.js"></script>
</body>
</html>
